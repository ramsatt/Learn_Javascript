
      

<h1>AJAX - The XMLHttpRequest Object</h1>

<!--start-->
<div class="ws-info">
<p>The keystone of AJAX is the XMLHttpRequest object.</p>
<ol>
<li>Create an XMLHttpRequest object</li>
<li>Define a callback function</li>
<li>Open the XMLHttpRequest object</li>
<li>Send a Request to a server</li>
</ol>
</div>
<!--stop-->
<!--start-->
<h2>The XMLHttpRequest Object</h2>
<p>All modern browsers support the <code class="w3-codespan">XMLHttpRequest</code> object.</p>
<p>The <code class="w3-codespan">XMLHttpRequest</code> object can be used to exchange data with a web server behind the 
scenes. This means that it is possible to update parts of a web page, without 
reloading the whole page.</p>
<!--stop-->
<hr>
<!--start-->
<h2>Create an XMLHttpRequest Object</h2>
<p>All modern browsers (Chrome, Firefox, IE, Edge, Safari, Opera) have a built-in <code class="w3-codespan">XMLHttpRequest</code> object.</p>
<p>Syntax for creating an <code class="w3-codespan">XMLHttpRequest</code> object:</p>
<pre class="w3-code"><code class="language-javascript"><div> <i>variable </i>= new XMLHttpRequest();</div></code></pre>
<!--stop-->
<hr>
<!--start-->
<h2>Define a Callback Function</h2>

<p>A callback function is a function passed as a parameter to another function.</p>
<p>In this case, the callback function should contain the code to execute when the 
response is ready.</p>
<pre class="w3-code"><code class="language-javascript">xhttp.onload = function() {
  // What to do when the response is ready
}</code></pre>
<!--stop-->
<hr>
<!--start-->
<h2>Send a Request</h2>
<p>To send a request to a server, you can use the open() and send() methods of the
<code class="w3-codespan">XMLHttpRequest</code> object:</p>
<pre class="w3-code"><code class="language-javascript">xhttp.open("GET", "ajax_info.txt");
xhttp.send();</code></pre>

<div class="w3-example">
<h3>Example</h3>
<pre class="w3-code"><code class="language-javascript">// Create an XMLHttpRequest object
const xhttp = new XMLHttpRequest();
// Define a callback function
xhttp.onload = function() {
  // Here you can use the Data
}
// Send a request
xhttp.open("GET", "ajax_info.txt");
xhttp.send();</code></pre>
  
</div>
<!--stop-->
<hr>
<!--start-->
<h2>Access Across Domains</h2>
<p>For security reasons, modern browsers do not allow access across domains.</p>
<p>This means that both the web page and the XML file it tries to load, must be located on the same server.</p>
<p>The examples on W3Schools all open XML files located on the W3Schools domain.</p>
<p>If you want to use the example above on one of your own web pages,
the XML files you load must be located on your own server.</p>

<!--stop-->
<hr>

<hr>
<!--start-->
<h2>XMLHttpRequest Object Methods</h2>
<div class="table-responsive-wrapper"><table class="ws-table-all notranslate">
  <tbody><tr>
    <th style="width:35%">Method</th>
    <th style="width:65%">Description</th>
  </tr>
  <tr>
    <td>new XMLHttpRequest()</td>
    <td>Creates a new XMLHttpRequest object</td>
  </tr>
  <tr>
    <td>abort()</td>
    <td>Cancels the current request</td>
  </tr>
  <tr>
    <td>getAllResponseHeaders()</td>
    <td>Returns header information</td>
  </tr>
  <tr>
    <td>getResponseHeader()</td>
    <td>Returns specific header information</td>
  </tr>
  <tr>
    <td>open(<em>method, url, async, user, psw</em>)</td>
    <td>Specifies the request<br><br><em>method</em>: the request type GET or POST<br>
 <em>url</em>: the file location<br>
 <em>async</em>: true (asynchronous) or false (synchronous)<br><em>user</em>: optional user name<br><em>psw</em>: optional password</td>
  </tr>
  <tr>
    <td>send()</td>
    <td>Sends the request to the server<br>Used for GET requests</td>
  </tr>
  <tr>
    <td>send(<em>string</em>)</td>
    <td>Sends the request to the server.<br>Used for POST requests</td>
  </tr>
  <tr>
    <td>setRequestHeader()</td>
    <td>Adds a label/value pair to the header to be sent</td>
  </tr>
</tbody></table></div>
<!--stop-->
<hr>
<!--start-->
<h2>XMLHttpRequest Object Properties</h2>
<div class="table-responsive-wrapper"><table class="ws-table-all notranslate">
  <tbody><tr>
    <th style="width:35%">Property</th>
    <th style="width:65%">Description</th>
  </tr>
  <tr>
    <td>onload</td>
    <td>Defines a function to be called when the request is received (loaded)</td>
  </tr>

  <tr>
    <td>onreadystatechange</td>
    <td>Defines a function to be called when the readyState property changes</td>
  </tr>
  <tr>
    <td>readyState</td>
    <td>Holds the status of the XMLHttpRequest.<br>
 0: request not initialized <br>
 1: server connection established<br>
 2: request received <br>
 3: processing request <br>
 4: request finished and response is ready </td>
  </tr>
  <tr>
    <td>responseText</td>
    <td>Returns the response data as a string</td>
  </tr>
  <tr>
    <td>responseXML</td>
    <td>Returns the response data as XML data</td>
  </tr>
  <tr>
    <td>status</td>
    <td>Returns the status-number of a request<br>200: "OK"<br>403: "Forbidden"<br>404: "Not Found"<br>
    For a complete list go to the <a href="../tags/ref_httpmessages.html">Http 
    Messages Reference</a></td>
  </tr>
  <tr>
    <td>statusText</td>
    <td>Returns the status-text (e.g. "OK" or "Not Found")</td>
  </tr>
</tbody></table></div>
<!--stop-->
<hr>
<!--start-->
<h2>The onload Property</h2>

<p>With the <code class="w3-codespan">XMLHttpRequest</code> object you can define a callback function to be executed when 
the request receives an answer.</p>
<p>The function is defined in the <code class="w3-codespan">onload</code> property of the <code class="w3-codespan">XMLHttpRequest</code> object:</p>

<div class="w3-example">
<h3>Example</h3>
<pre class="w3-code"><code class="language-javascript">xhttp.onload = function() {
  document.getElementById("demo").innerHTML = this.responseText;
}
xhttp.open("GET", "ajax_info.txt");
xhttp.send();</code></pre>

</div>
<!--stop-->
<hr>
<!--start-->
<h2>Multiple Callback Functions</h2>

<p>If you have more than one AJAX task in a website, you should create one function for 
executing the <code class="w3-codespan">XMLHttpRequest</code> object, and one callback function for each 
AJAX task.</p>
<p>The function call should contain the URL and what function to call when the 
response is ready.</p>

<div class="w3-example">
<h3>Example</h3>
<pre class="w3-code"><code class="language-javascript">loadDoc("<em>url-1</em>", myFunction1);
loadDoc("<em>url-2</em>", myFunction2);
function loadDoc(url, cFunction) {
  const xhttp = new XMLHttpRequest();
  xhttp.onload = function() {cFunction(this);}
  xhttp.open("GET", url);
  xhttp.send();
}
function myFunction1(xhttp) {
  // action goes here
}
function myFunction2(xhttp) {
  // action goes here
}</code></pre>
</div>
<!--stop-->
<hr>
<!--start-->
<h2>The onreadystatechange Property</h2>
<p>The <code class="w3-codespan">readyState</code> property holds the status of the XMLHttpRequest.</p>
<p>The <code class="w3-codespan">onreadystatechange</code> property defines a callback function to be executed when the readyState changes.</p>
<p>The <code class="w3-codespan">status</code> property and the <code class="w3-codespan">statusText</code> properties hold the status of the XMLHttpRequest object.</p>
<div class="table-responsive-wrapper"><table class="ws-table-all notranslate"> 
  <tbody><tr>
    <th style="width:20%">Property</th>
    <th>Description</th>
  </tr>  
  <tr>
    <td>onreadystatechange</td>
    <td>Defines a function to be called when the readyState property changes</td>
  </tr>
  <tr>
    <td>readyState</td>
    <td>Holds the status of the XMLHttpRequest. <br>
 0: request not initialized <br>
 1: server connection established<br>
 2: request received <br>
 3: processing request <br>
 4: request finished and response is ready</td>
  </tr>
  <tr>
    <td>status</td>
    <td>200: "OK"<br>403: "Forbidden"<br>
 404: "Page not found"<br>For a complete list go to the
    <a href="../tags/ref_httpmessages.html">Http Messages Reference</a></td>
  </tr>
  <tr>
    <td>statusText</td>
    <td>Returns the status-text (e.g. "OK" or "Not Found")</td>
  </tr>
</tbody></table></div>

<p>The <code class="w3-codespan">onreadystatechange</code> function is called every time the readyState changes. </p>
<p>When <code class="w3-codespan">readyState</code> is 4 and status is 200, the response is ready:</p>

<div class="w3-example">
<h3>Example</h3>
<pre class="w3-code"><code class="language-javascript">function loadDoc() {
  const xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 &amp;&amp; this.status == 200) {
      document.getElementById("demo").innerHTML =
      this.responseText;
    }
  };
  xhttp.open("GET", "ajax_info.txt");
  xhttp.send();
}</code></pre>

</div>
<div class="w3-panel ws-note">
<p>The <code class="w3-codespan">onreadystatechange</code> event is triggered four times (1-4), one time for each change in the readyState.</p>
</div>
<!--stop-->
<br>
<div class="w3-clear nextprev">
<a class="w3-left w3-btn" href="js_ajax_intro.html">❮ Previous</a>
<a class="w3-right w3-btn" href="js_ajax_http_send.html">Next ❯</a>
</div>


