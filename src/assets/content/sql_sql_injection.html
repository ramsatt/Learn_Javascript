<h1>SQL <span class="color_h1">Injection</span></h1>

<hr>

<h2>SQL Injection</h2>
<p>SQL injection is a code injection technique that might destroy your database.</p>
<p>SQL injection is one of the most common web hacking techniques.</p>
<p>SQL injection is the placement of malicious code in SQL statements, via web page input.</p>
<hr>

<h2>SQL in Web Pages</h2>
<p>SQL injection usually occurs when you ask a user for input, like their 
username/userid, and instead of a name/id, the user gives you an SQL statement 
that you will <strong>unknowingly</strong> run on your database.</p>
<p>Look at the following example which creates a <code class="w3-codespan">
SELECT</code> statement by adding a variable 
(txtUserId) to a select string. The variable is fetched from user input 
(getRequestString):</p>
<div class="w3-example">
<h3>Example</h3>
<div class="w3-code notranslate">
 txtUserId = getRequestString(&quot;UserId&quot;);<br>txtSQL = &quot;SELECT *
FROM Users WHERE UserId = &quot; + txtUserId;</div>
</div>
<p>The rest of this chapter describes the potential dangers of using user input in SQL statements.</p>
<hr>

<h2>SQL Injection Based on 1=1 is Always True</h2>
<p>Look at the example above again. The original purpose of the code was to create an SQL statement to select a 
user, with a given user id.</p>
<p>If there is nothing to prevent a user from entering &quot;wrong&quot; input, the user 
can enter some &quot;smart&quot; input like this:</p>
<p>UserId: <input type="text" name="UserId" value="105 OR 1=1"></p>

<p>Then, the SQL statement will look like this:</p>
<div class="w3-example">
<div class="w3-code notranslate sqlHigh">
SELECT * FROM Users WHERE UserId = 105 OR 1=1;</div>
</div>

<p>The SQL above is valid and will return ALL rows from the &quot;Users&quot; table, since <strong>
OR 1=1</strong> is always TRUE.</p>
<p>Does the example above look dangerous? What if the &quot;Users&quot; table contains names and passwords?</p>
<p>The SQL statement above is much the same as this:</p>
<div class="w3-example">
<div class="w3-code notranslate sqlHigh">
SELECT UserId, Name, Password
FROM Users WHERE UserId = 105 or 1=1;</div>
</div>
<p>A hacker might get access to all the user names and passwords in a database, by 
simply inserting 
105 OR 1=1 into the input field.</p>
<hr>

<hr>

<h2>SQL Injection Based on&nbsp;&quot;&quot;=&quot;&quot; is Always True</h2>
<p>Here is an example of a user login on a web site:</p>
<p>Username:<br>
<input style="padding:4px" type="text" name="uName" value="John Doe"></p>
<p>Password:<br>
<input style="padding:4px" type="text" name="uPass" value="myPass"></p>
<div class="w3-example">
<h3>Example</h3>
<div class="w3-code notranslate">
uName = getRequestString(&quot;username&quot;);<br>uPass = getRequestString(&quot;userpassword&quot;);<br>
<br>sql = 'SELECT * FROM Users WHERE Name =&quot;' + uName + '&quot; AND Pass =&quot;' + uPass + 
 '&quot;'</div>
</div>

<div class="w3-example">
<h3>Result</h3>
<div class="w3-code notranslate sqlHigh">
SELECT * FROM Users WHERE Name =&quot;John Doe&quot; AND Pass =&quot;myPass&quot;</div>
</div>

<p>
A hacker might get access to user names and passwords&nbsp;in a database by 
simply inserting &quot; OR &quot;&quot;=&quot; into the user name or password text box:</p>

<p>User Name:<br>
<input style="padding:4px" type="text" name="uName" value='" or ""="'></p>
<p>Password:<br>
<input style="padding:4px" type="text" name="uPass" value='" or ""="'></p>


<p>The code at the server will create a valid SQL statement like this:</p>
<div class="w3-example">
<h3>Result</h3>
<div class="w3-code notranslate sqlHigh">
SELECT * FROM Users WHERE Name =&quot;&quot; or &quot;&quot;=&quot;&quot; AND Pass =&quot;&quot; or &quot;&quot;=&quot;&quot;</div>
</div>
<p>The SQL above is valid and will return all rows from the &quot;Users&quot; table, 
since <strong>OR &quot;&quot;=&quot;&quot;</strong> is always TRUE.</p>
<hr>

<h2>SQL Injection Based on Batched SQL Statements&nbsp;</h2>
<p>Most databases support batched SQL statement.</p>
<p>A batch of SQL statements is a group of two or more SQL statements, separated by semicolons.</p>
<p>The SQL statement below will return all rows from the &quot;Users&quot; table, then delete the 
&quot;Suppliers&quot; table.</p>
<div class="w3-example">
<h3>Example</h3>
<div class="w3-code notranslate sqlHigh">
SELECT * FROM Users; DROP TABLE Suppliers
</div>
</div>
<p>Look at the following example: </p>
<div class="w3-example">
<h3>Example</h3>
<div class="w3-code notranslate">
txtUserId = getRequestString(&quot;UserId&quot;);<br>txtSQL = &quot;SELECT *
FROM Users WHERE UserId = &quot; + txtUserId;</div>
</div>

<p>And the following input:</p>
<p>User id: <input type="text" style="width:250px"name="UserId" value="105; DROP TABLE Suppliers"></p>
<p>The valid SQL statement would look like this:</p>
<div class="w3-example">
<h3>Result</h3>
<div class="w3-code notranslate sqlHigh">
SELECT * FROM Users WHERE 
UserId = 105; DROP TABLE Suppliers;</div>
</div>
<hr>

<h2>Use SQL Parameters for Protection</h2>
<p>To protect a web site from SQL injection, you can use SQL parameters.</p>
<p>SQL parameters are values that are added to an SQL query at execution time, in a controlled manner.</p>
<div class="w3-example">
<h3>ASP.NET Razor Example</h3>
<div class="w3-code notranslate">
txtUserId = getRequestString(&quot;UserId&quot;);<br>txtSQL = &quot;SELECT *
FROM Users WHERE UserId = @0&quot;;<br>db.Execute(txtSQL,txtUserId);</div>
</div>
<p>Note that parameters are represented in the SQL statement by a @ marker.</p>
<p>The SQL engine checks each parameter to ensure that it is correct for its column
and are treated literally, and not as part of the SQL to be executed.</p>
<div class="w3-example">
<h3>Another Example</h3>
<div class="w3-code notranslate">
 txtNam = getRequestString(&quot;CustomerName&quot;);<br>txtAdd = getRequestString(&quot;Address&quot;);<br>txtCit = getRequestString(&quot;City&quot;);<br>
 txtSQL = &quot;INSERT INTO Customers (CustomerName,Address,City) Values(@0,@1,@2)&quot;;<br>db.Execute(txtSQL,txtNam,txtAdd,txtCit);</div>
</div>

<hr>

<h2>Examples</h2>
<p>The following examples shows how to build parameterized queries in some common web languages.</p>
<p>SELECT STATEMENT IN ASP.NET:</p>
<div class="w3-example">
<div class="w3-code notranslate">
 txtUserId = getRequestString(&quot;UserId&quot;);<br>
 sql = &quot;SELECT * FROM Customers WHERE CustomerId = @0&quot;;<br>command = new SqlCommand(sql);<br>command.Parameters.AddWithValue(&quot;@0&quot;,txtUserId);<br>
 command.ExecuteReader();</div>
</div>
<p>INSERT INTO STATEMENT IN ASP.NET:</p>
<div class="w3-example">
<div class="w3-code notranslate">
 txtNam = getRequestString(&quot;CustomerName&quot;);<br>txtAdd = getRequestString(&quot;Address&quot;);<br>txtCit = getRequestString(&quot;City&quot;);<br>
 txtSQL = &quot;INSERT INTO Customers (CustomerName,Address,City) Values(@0,@1,@2)&quot;;<br>command = new SqlCommand(txtSQL);<br>
 command.Parameters.AddWithValue(&quot;@0&quot;,txtNam);<br>
 command.Parameters.AddWithValue(&quot;@1&quot;,txtAdd);<br>
 command.Parameters.AddWithValue(&quot;@2&quot;,txtCit);<br>command.ExecuteNonQuery();</div>
</div>

<p>INSERT INTO STATEMENT IN PHP:</p>
<div class="w3-example">
<div class="w3-code notranslate">
 $stmt = $dbh-&gt;prepare(&quot;INSERT INTO Customers (CustomerName,Address,City) <br>
 VALUES (:nam, :add, :cit)&quot;);<br>$stmt-&gt;bindParam(':nam', $txtNam);<br>
 $stmt-&gt;bindParam(':add', $txtAdd);<br>$stmt-&gt;bindParam(':cit', $txtCit);<br>
 $stmt-&gt;execute();</div>
</div>

<hr>

<hr>

<br>