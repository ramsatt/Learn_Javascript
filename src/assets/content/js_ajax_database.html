
      

<h1>AJAX Database Example</h1>

<hr>
<!--start-->
<p class="intro">AJAX can be used for interactive communication with a database.</p>
<hr>
<h2>AJAX Database Example</h2>
<p>The following example will demonstrate how a web page can fetch 
information from a database with AJAX:</p>

<div class="w3-example">
<h3>Example</h3>

<p>

</p>
</div>
<hr>

<h2>Example Explained - The showCustomer() Function</h2>
<p>When a user selects a customer in the dropdown list above, a function called <code class="w3-codespan">showCustomer()</code> is executed. The 
function is triggered by the <code class="w3-codespan">onchange</code> event:</p> 

<div class="w3-example">
<h3>showCustomer</h3>
<pre class="w3-code"><code class="language-javascript">function showCustomer(str) {
  if (str == "") {
    document.getElementById("txtHint").innerHTML = "";
    return;
  }
  const xhttp = new XMLHttpRequest();
  xhttp.onload = function() {
    document.getElementById("txtHint").innerHTML = this.responseText;
  }
  xhttp.open("GET", "getcustomer.php?q="+str);
  xhttp.send();
}</code></pre>
</div>

<p>The <code class="w3-codespan">showCustomer()</code> function does the following:</p>
<ul>
  <li>Check if a customer is selected</li>
  <li>Create an XMLHttpRequest object</li>
  <li>Create the function to be executed when the server response is ready</li>
  <li>Send the request off to a file on the server</li>
  <li>Notice that a parameter (q) is added to the URL (with the content of the dropdown list)</li>
</ul>
<!--stop-->
<hr>

<hr>
<!--start-->
<h2>The AJAX Server Page</h2>

<p>The page on the server called by the JavaScript above is a PHP file called "getcustomer.php".</p>
<p>The source code in "getcustomer.php" runs a query against a database, and returns the result in an HTML 
table:</p>

<pre class="w3-code"><code class="language-html">&lt;?php
$mysqli = new mysqli("<em>servername</em>", "<em>username</em>", "<em>password</em>", "<em>dbname</em>");
if($mysqli-&gt;connect_error) {
  exit('Could not connect');
}
$sql = "SELECT customerid, companyname, contactname, address, city, postalcode, country
FROM customers WHERE customerid = ?";
$stmt = $mysqli-&gt;prepare($sql);
$stmt-&gt;bind_param("s", $_GET['q']);
$stmt-&gt;execute();
$stmt-&gt;store_result();
$stmt-&gt;bind_result($cid, $cname, $name, $adr, $city, $pcode, $country);
$stmt-&gt;fetch();
$stmt-&gt;close();
echo "&lt;table&gt;";
echo "&lt;tr&gt;";
echo "&lt;th&gt;CustomerID&lt;/th&gt;";
echo "&lt;td&gt;" . $cid . "&lt;/td&gt;";
echo "&lt;th&gt;CompanyName&lt;/th&gt;";
echo "&lt;td&gt;" . $cname . "&lt;/td&gt;";
echo "&lt;th&gt;ContactName&lt;/th&gt;";
echo "&lt;td&gt;" . $name . "&lt;/td&gt;";
echo "&lt;th&gt;Address&lt;/th&gt;";
echo "&lt;td&gt;" . $adr . "&lt;/td&gt;";
echo "&lt;th&gt;City&lt;/th&gt;";
echo "&lt;td&gt;" . $city . "&lt;/td&gt;";
echo "&lt;th&gt;PostalCode&lt;/th&gt;";
echo "&lt;td&gt;" . $pcode . "&lt;/td&gt;";
echo "&lt;th&gt;Country&lt;/th&gt;";
echo "&lt;td&gt;" . $country . "&lt;/td&gt;";
echo "&lt;/tr&gt;";
echo "&lt;/table&gt;";
?&gt;</code></pre>
<!--stop-->
<br>
<div class="w3-clear nextprev">
<a class="w3-left w3-btn" href="js_ajax_asp.html">❮ Previous</a>
<a class="w3-right w3-btn" href="js_ajax_applications.html">Next ❯</a>
</div>


